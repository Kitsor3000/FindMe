{% extends 'base.html' %}
{% block content %}

<div class="container mt-5 mb-5">
  <div class="row justify-content-center">
    <div class="col-lg-6">
      <div class="card p-4 shadow-sm rounded-4 border-0 profile-card">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="fw-bold text-primary">üë§ –ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å</h3>
          
          {% if profile.role == "volunteer" %}
            <span class="badge bg-success px-3 py-2 fs-6">–í–æ–ª–æ–Ω—Ç–µ—Ä</span>
          {% endif %}
        </div>

        <form method="post" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="text-center mb-3">
            {% if profile.photo %}
              <img src="{{ profile.photo.url }}" class="rounded-circle shadow-sm" width="120" height="120" alt="–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é">
            {% else %}
              <img src="/static/img/default-avatar.png" class="rounded-circle shadow-sm" width="120" height="120" alt="–ë–µ–∑ —Ñ–æ—Ç–æ">
            {% endif %}
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–Ü–º‚Äô—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</label>
            <input type="text" name="username" class="form-control rounded-3" value="{{ user.username }}">
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ø–æ—à—Ç–∞</label>
            <input type="email" name="email" class="form-control rounded-3" value="{{ user.email }}">
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å</label>
            <div class="input-group">
              <input type="password" name="password" id="password" class="form-control rounded-start-3" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
              <button type="button" class="btn btn-outline-secondary" id="togglePassword"><i class="bi bi-eye"></i></button>
            </div>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–¢–µ–ª–µ—Ñ–æ–Ω</label>
            <input type="text" name="phone" class="form-control rounded-3" value="{{ profile.phone }}">
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–ü—Ä–æ —Å–µ–±–µ</label>
            <textarea name="bio" class="form-control rounded-3" rows="3">{{ profile.bio }}</textarea>
          </div>

          <div class="mb-3">
            <label class="form-label fw-semibold">–§–æ—Ç–æ –ø—Ä–æ—Ñ—ñ–ª—é</label>
            <input type="file" name="photo" class="form-control rounded-3">
          </div>

          <button type="submit" class="btn btn-primary w-100 mt-3">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏</button>
        </form>

        {% if profile.role == "volunteer" %}
          <a href="{% url 'stop_being_volunteer' %}" class="btn btn-outline-danger w-100 mt-3">üö´ –ü–µ—Ä–µ—Å—Ç–∞—Ç–∏ –±—É—Ç–∏ –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–º</a>
        {% endif %}

        <hr class="my-4">
        <div class="text-center text-muted">
          <p>üìÑ –û–≥–æ–ª–æ—à–µ–Ω—å —Å—Ç–≤–æ—Ä–µ–Ω–æ: <strong>{{ total_posts }}</strong></p>
          <p>üí¨ –û—Ç—Ä–∏–º–∞–Ω–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: <strong>{{ total_messages }}</strong></p>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- üëÅÔ∏è JS –¥–ª—è –ø–∞—Ä–æ–ª—è -->
<script>
  document.getElementById('togglePassword').addEventListener('click', function() {
    const input = document.getElementById('password');
    const icon = this.querySelector('i');
    if (input.type === 'password') {
      input.type = 'text';
      icon.classList.replace('bi-eye', 'bi-eye-slash');
    } else {
      input.type = 'password';
      icon.classList.replace('bi-eye-slash', 'bi-eye');
    }
  });
</script>

<style>
  :root {
    --bg-color: #ffffff;
    --label-text-color: #212529;     
    --input-text-color: #212529;
    --input-bg: #f8f9fa;
    --input-border: rgba(180,180,180,0.4);
    --card-bg: #ffffff;
  }

  [data-theme='dark'] {
    --bg-color: #050920;
    --label-text-color: #ffffff;
    --input-text-color: #030303;
    --input-bg: #989898;
    --input-border: #444;
    --card-bg: #202845;
  }

  body {
    background-color: var(--bg-color);
    color: var(--label-text-color);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .profile-card {
    background-color: var(--card-bg);
    transition: background-color 0.3s ease, color 0.3s ease;
  }

  .badge.bg-success {
    font-weight: 600;
    border-radius: 10px;
  }

  input, textarea {
    background-color: var(--input-bg);
    color: var(--input-text-color);
    border: 1px solid var(--input-border);
    transition: all 0.3s ease;
  }

  input:focus, textarea:focus {
    border-color: #007bff;
    box-shadow: 0 0 6px rgba(0,123,255,0.3);
  }

  .btn-primary {
    background: linear-gradient(135deg, #0d6efd, #007bff);
    border: none;
  }

  .btn-primary:hover {
    background: linear-gradient(135deg, #0056d2, #0041a3);
  }
</style>

{% endblock %}
