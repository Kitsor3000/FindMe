{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-center align-items-center">
  <div class="col-lg-7 col-md-9">
    <div class="card p-4 shadow-lg rounded-4 border-0 form-card mb-5">
      <h2 class="mb-4 text-center fw-bold text-primary">–î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è</h2>

      <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
        {% csrf_token %}

        <!-- –ü–Ü–ë -->
        <div class="form-group mb-3">
          <label class="form-label fw-semibold">–ü–Ü–ë –∑–Ω–∏–∫–ª–æ—ó –æ—Å–æ–±–∏</label>
          {{ form.full_name }}
        </div>

        <!-- –û–±–ª–∞—Å—Ç—å -->
       <div class="form-group mb-3 position-relative">
  <label class="form-label fw-semibold">–û–±–ª–∞—Å—Ç—å</label>
  <select id="regionSelect" name="region" class="form-select rounded-3">
    <option value="" disabled selected>–û–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å...</option>
    <option>–í—ñ–Ω–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–í–æ–ª–∏–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–î–æ–Ω–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–õ—É–≥–∞–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–°—É–º—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å</option>
    <option>–º. –ö–∏—ó–≤</option>
  </select>
</div>


        <!-- –ú—ñ—Å—Ç–æ -->
      <div class="form-group mb-3 position-relative">
  <label class="form-label fw-semibold">–ú—ñ—Å—Ç–æ</label>
  <input type="text" id="cityInput" name="city" class="form-control rounded-3" placeholder="–í–≤–µ–¥—ñ—Ç—å –∞–±–æ –≤–∏–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ç–æ..." autocomplete="off">
  <div id="cityDropdown" class="dropdown-menu w-100 shadow-sm" style="max-height: 180px; overflow-y: auto;"></div>
</div>

        <!-- –î–∞—Ç–∞ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è -->
        <div class="form-group mb-3">
          <label class="form-label fw-semibold">–î–∞—Ç–∞ –∑–Ω–∏–∫–Ω–µ–Ω–Ω—è</label>
          {{ form.missing_date }}
        </div>

        <div class="form-group mb-3">
  <label class="form-label fw-semibold">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
  {{ form.category }}
</div>

<div class="form-group mb-3">
  <label class="form-label fw-semibold">–°—Ç–∞—Ç—É—Å</label>
  {{ form.status }}
</div>


        <!-- –§–æ—Ç–æ -->
        <div class="form-group mb-3">
          <label class="form-label fw-semibold">–§–æ—Ç–æ</label>
          {{ form.photo }}
        </div>

        <!-- –ú—ñ—Å—Ü–µ –Ω–∞ –∫–∞—Ä—Ç—ñ -->
        <div class="form-group mb-3">
          <label class="form-label fw-semibold">–û—Å—Ç–∞–Ω–Ω—î –º—ñ—Å—Ü–µ, –¥–µ –±–∞—á–∏–ª–∏</label>
          {{ form.location }}
        </div>

        <!-- üó∫Ô∏è –Ü–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞ –º–∞–ø–∞ -->
        <div class="form-group mb-4">
          <label class="form-label fw-semibold">–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ –Ω–∞ –º–∞–ø—ñ</label>
          <div id="map" style="height: 300px; border-radius: 12px;"></div>
          {{ form.latitude }}
          {{ form.longitude }}
        </div>

        <!-- –û–ø–∏—Å -->
        <div class="form-group mb-4">
          <label class="form-label fw-semibold">–û–ø–∏—Å</label>
          {{ form.description }}
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ -->
        <button type="submit" class="btn btn-primary w-100 py-2 rounded-3 fw-semibold shadow-sm">
          <i class="bi bi-plus-circle me-1"></i> –ó–±–µ—Ä–µ–≥—Ç–∏
        </button>
      </form>
    </div>
  </div>
</div>

<!-- üó∫Ô∏è Leaflet -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const map = L.map('map').setView([49.9935, 36.2304], 6); // –¶–µ–Ω—Ç—Ä –£–∫—Ä–∞—ó–Ω–∏
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);

  let marker;
  map.on('click', function(e) {
    const { lat, lng } = e.latlng;
    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lng]).addTo(map);
    document.getElementById('id_latitude').value = lat;
    document.getElementById('id_longitude').value = lng;
  });

  
  // üîπ –ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –≤–µ–ª–∏–∫–∏—Ö –º—ñ—Å—Ç –£–∫—Ä–∞—ó–Ω–∏ (–æ–±–ª–∞—Å–Ω—ñ —Ü–µ–Ω—Ç—Ä–∏ + —ñ–Ω—à—ñ)
  const citiesByRegion = {
    "–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∏–π", "–ö–∞–º‚Äô—è–Ω–µ—Ü—å-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π", "–®–µ–ø–µ—Ç—ñ–≤–∫–∞", "–°—Ç–∞—Ä–æ–∫–æ—Å—Ç—è–Ω—Ç–∏–Ω—ñ–≤", "–ù–µ—Ç—ñ—à–∏–Ω"],
    "–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ë—ñ–ª–∞ –¶–µ—Ä–∫–≤–∞", "–ë–æ—Ä–∏—Å–ø—ñ–ª—å", "–ë—Ä–æ–≤–∞—Ä–∏", "–Ü—Ä–ø—ñ–Ω—å", "–§–∞—Å—Ç—ñ–≤", "–í–∏—à–≥–æ—Ä–æ–¥"],
    "–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–õ—å–≤—ñ–≤", "–î—Ä–æ–≥–æ–±–∏—á", "–ß–µ—Ä–≤–æ–Ω–æ–≥—Ä–∞–¥", "–°—Ç—Ä–∏–π", "–°–∞–º–±—ñ—Ä", "–¢—Ä—É—Å–∫–∞–≤–µ—Ü—å", "–ë–æ—Ä–∏—Å–ª–∞–≤"],
    "–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–û–¥–µ—Å–∞", "–ß–æ—Ä–Ω–æ–º–æ—Ä—Å—å–∫", "–ë—ñ–ª–≥–æ—Ä–æ–¥-–î–Ω—ñ—Å—Ç—Ä–æ–≤—Å—å–∫–∏–π", "–Ü–∑–º–∞—ó–ª", "–ü–æ–¥—ñ–ª—å—Å—å–∫", "–Æ–∂–Ω–µ"],
    "–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–•–∞—Ä–∫—ñ–≤", "–Ü–∑—é–º", "–ö—É–ø'—è–Ω—Å—å–∫", "–õ–æ–∑–æ–≤–∞", "–ú–µ—Ä–µ—Ñ–∞"],
    "–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–î–Ω—ñ–ø—Ä–æ", "–ö—Ä–∏–≤–∏–π –†—ñ–≥", "–ö–∞–º‚Äô—è–Ω—Å—å–∫–µ", "–ü–∞–≤–ª–æ–≥—Ä–∞–¥", "–ù—ñ–∫–æ–ø–æ–ª—å"],
    "–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ß–µ—Ä–∫–∞—Å–∏", "–£–º–∞–Ω—å", "–°–º—ñ–ª–∞", "–ó–æ–ª–æ—Ç–æ–Ω–æ—à–∞"],
    "–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ß–µ—Ä–Ω—ñ–≤—Ü—ñ", "–ù–æ–≤–æ—Å–µ–ª–∏—Ü—è", "–•–æ—Ç–∏–Ω"],
    "–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ü–æ–ª—Ç–∞–≤–∞", "–ö—Ä–µ–º–µ–Ω—á—É–∫", "–ú–∏—Ä–≥–æ—Ä–æ–¥", "–õ—É–±–Ω–∏"],
    "–í—ñ–Ω–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–í—ñ–Ω–Ω–∏—Ü—è", "–ñ–º–µ—Ä–∏–Ω–∫–∞", "–ú–æ–≥–∏–ª—ñ–≤-–ü–æ–¥—ñ–ª—å—Å—å–∫–∏–π"],
    "–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–†—ñ–≤–Ω–µ", "–î—É–±–Ω–æ", "–í–∞—Ä–∞—à", "–û—Å—Ç—Ä–æ–≥"],
    "–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫", "–ö–æ–ª–æ–º–∏—è", "–ö–∞–ª—É—à", "–Ø—Ä–µ–º—á–µ"],
    "–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–£–∂–≥–æ—Ä–æ–¥", "–ú—É–∫–∞—á–µ–≤–æ", "–•—É—Å—Ç", "–ë–µ—Ä–µ–≥–æ–≤–µ"],
    "–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–¢–µ—Ä–Ω–æ–ø—ñ–ª—å", "–ß–æ—Ä—Ç–∫—ñ–≤", "–ö—Ä–µ–º–µ–Ω–µ—Ü—å"],
    "–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ñ–∏—Ç–æ–º–∏—Ä", "–ë–µ—Ä–¥–∏—á—ñ–≤", "–ö–æ—Ä–æ—Å—Ç–µ–Ω—å", "–ù–æ–≤–æ–≥—Ä–∞–¥-–í–æ–ª–∏–Ω—Å—å–∫–∏–π"],
    "–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ó–∞–ø–æ—Ä—ñ–∂–∂—è", "–ú–µ–ª—ñ—Ç–æ–ø–æ–ª—å", "–ë–µ—Ä–¥—è–Ω—Å—å–∫", "–ï–Ω–µ—Ä–≥–æ–¥–∞—Ä"],
    "–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ú–∏–∫–æ–ª–∞—ó–≤", "–í–æ–∑–Ω–µ—Å–µ–Ω—Å—å–∫", "–ü–µ—Ä–≤–æ–º–∞–π—Å—å–∫"],
    "–°—É–º—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–°—É–º–∏", "–ö–æ–Ω–æ—Ç–æ–ø", "–®–æ—Å—Ç–∫–∞", "–û—Ö—Ç–∏—Ä–∫–∞"],
    "–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–•–µ—Ä—Å–æ–Ω", "–ù–æ–≤–∞ –ö–∞—Ö–æ–≤–∫–∞", "–°–∫–∞–¥–æ–≤—Å—å–∫"],
    "–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å": ["–ß–µ—Ä–Ω—ñ–≥—ñ–≤", "–ù—ñ–∂–∏–Ω", "–ü—Ä–∏–ª—É–∫–∏"],
    "–º. –ö–∏—ó–≤": ["–ö–∏—ó–≤"],
  };

  // üîÅ –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—Ä–∏ –≤–∏–±–æ—Ä—ñ –æ–±–ª–∞—Å—Ç—ñ
  regionSelect.addEventListener("change", () => {
    cityInput.value = "";
    cityDropdown.innerHTML = "";
  });

  // üß† –ê–≤—Ç–æ–ø–æ—à—É–∫ —É –ø–æ–ª—ñ –º—ñ—Å—Ç–∞
  cityInput.addEventListener("input", () => {
    const region = regionSelect.value;
    const query = cityInput.value.toLowerCase();
    const cities = citiesByRegion[region] || [];

    cityDropdown.innerHTML = "";
    if (query.length > 0 && cities.length > 0) {
      const matches = cities.filter(c => c.toLowerCase().includes(query));
      matches.forEach(city => {
        const option = document.createElement("div");
        option.className = "dropdown-item";
        option.textContent = city;
        option.addEventListener("click", () => {
          cityInput.value = city;
          cityDropdown.classList.remove("show");
        });
        cityDropdown.appendChild(option);
      });
      if (matches.length > 0) {
        cityDropdown.classList.add("show");
      } else {
        cityDropdown.classList.remove("show");
      }
    } else {
      cityDropdown.classList.remove("show");
    }
  });
});




</script>

<style>
  /* üé® –ë–∞–∑–æ–≤—ñ –∫–æ–ª—å–æ—Ä–∏ (—Å–≤—ñ—Ç–ª–∞ —Ç–µ–º–∞) */
  :root {
    --bg-color: #ffffff;
    --label-text-color: #212529;     
  --input-text-color: #212529;
    --input-bg: #f8f9fa;
    --input-border: rgba(180,180,180,0.4);
    --card-bg: #ffffff;
  }

  /* üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
  [data-theme='dark'] {
    --bg-color: #121212;
     --label-text-color: #823232;
  --input-text-color: #030303;
    --input-bg: #989898;
    --input-border: #444;
    --card-bg: #202845;
  }

  /* –û—Å–Ω–æ–≤–Ω–∞ —Ñ–æ—Ä–º–∞ */
  .form-card {
    background: var(--card-bg);
    transition: all 0.3s ease;
    color: var(--text-color);
  }

  .form-label {
    color: var(--text-color);
  }

  input[type="text"],
  input[type="date"],
  input[type="file"],
  textarea {
    width: 100%;
    border: 1px solid var(--input-border);
    border-radius: 0.6rem;
    padding: 10px 14px;
    background-color: var(--input-bg);
    color: var(--text-color);
    transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease;
  }

  input:focus,
  textarea:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 6px rgba(13,110,253,0.3);
    outline: none;
  }

  button.btn-primary {
    background: linear-gradient(135deg, #0d6efd, #007bff);
    border: none;
    transition: all 0.25s ease;
  }

  button.btn-primary:hover {
    background: linear-gradient(135deg, #007bff, #0056d2);
    transform: scale(1.02);
  }

  footer {
    margin-top: 30px !important;
  }


  .dropdown-menu {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  z-index: 1000;
  background-color: var(--input-bg);
  border: 1px solid var(--input-border);
  border-radius: 0.5rem;
  padding: 0.3rem 0;
  width: 100%;
  transition: all 0.15s ease;
}

.dropdown-menu.show {
  display: block;
  animation: fadeIn 0.15s ease-in;
}

.dropdown-item {
  padding: 8px 14px;
  cursor: pointer;
  color: var(--input-text-color);
}

.dropdown-item:hover {
  background-color: #0d6efd;
  color: #fff;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-4px); }
  to { opacity: 1; transform: translateY(0); }
}
</style>

{% endblock %}
