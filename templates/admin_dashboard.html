{% extends 'base.html' %}
{% block content %}
<div class="container py-5">

  <!-- üîπ –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div class="text-center mb-5">
    <h1 class="fw-bold display-5 text-primary mb-2">üìä –ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
    <p class="lead text-muted">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ –∑–Ω–∏–∫–ª–∏—Ö –æ—Å—ñ–±, —Ä–µ–≥—ñ–æ–Ω—ñ–≤ —ñ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤</p>
  </div>

  

  <!-- üìà –ì—Ä–∞—Ñ—ñ–∫–∏ -->
  <div class="row g-4">
    <div class="col-lg-6">
      <div class="chart-card p-4 rounded-4 shadow-sm">
        <h5 class="fw-semibold mb-3">üìä –†–æ–∑–ø–æ–¥—ñ–ª –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º</h5>
        <canvas id="statusChart" height="200"></canvas>
      </div>
    </div>

    <div class="col-lg-6">
      <div class="chart-card p-4 rounded-4 shadow-sm">
        <h5 class="fw-semibold mb-3">üó∫Ô∏è –†–µ–≥—ñ–æ–Ω–∏ –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –æ–≥–æ–ª–æ—à–µ–Ω—å</h5>
        <canvas id="regionChart" height="300"></canvas>
      </div>
    </div>

    <div class="col-lg-12">
      <div class="chart-card p-4 rounded-4 shadow-sm mt-4">
        <h5 class="fw-semibold mb-3">üìÜ –ù–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 7 –¥–Ω—ñ–≤</h5>
        <canvas id="weeklyChart" height="90"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- ‚öôÔ∏è Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // üì¶ –î–∞–Ω—ñ —ñ–∑ Django
  const statusData = JSON.parse('{{ status_data|escapejs }}');
  const regionData = JSON.parse('{{ region_data|escapejs }}');
  const weeklyData = JSON.parse('{{ weekly_data|escapejs }}');

  // üé® –û—Å–Ω–æ–≤–Ω—ñ –∫–æ–ª—å–æ—Ä–∏ (—Ä–µ–¥–∞–≥—É–π —Ç—É—Ç)
  const COLORS = {
    missing: '#FF1493',   // —á–µ—Ä–≤–æ–Ω–∏–π
    found: '#00FF7F	',     // –∑–µ–ª–µ–Ω–∏–π
    other: '#48D1CC',     // —Å–∏–Ω—ñ–π
    bg: '#ffffff',        // —Ñ–æ–Ω –≥—Ä–∞—Ñ—ñ–∫—ñ–≤
    text: '#222222',      // –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É (–¥–ª—è —Å–≤—ñ—Ç–ª–æ—ó —Ç–µ–º–∏)
    textDark: '#f1f1f1',   // –∫–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É (–¥–ª—è —Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏)
     others: '#6A5ACD'
  };

  // üß© –ì—Ä–∞—Ñ—ñ–∫ –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º
  new Chart(document.getElementById('statusChart'), {
    type: 'doughnut',
    data: {
      labels: Object.keys(statusData),
      datasets: [{
        data: Object.values(statusData),
        backgroundColor: [COLORS.missing, COLORS.found, COLORS.other],
        borderWidth: 0
      }]
    },
    options: {
      plugins: {
        legend: {
          position: 'bottom',
          labels: { color: COLORS.text }
        }
      }
    }
  });

  // üìç –ì—Ä–∞—Ñ—ñ–∫ –∑–∞ —Ä–µ–≥—ñ–æ–Ω–∞–º–∏
  new Chart(document.getElementById('regionChart'), {
    type: 'bar',
    data: {
      labels: Object.keys(regionData),
      datasets: [{
        label: '–ö—ñ–ª—å–∫—ñ—Å—Ç—å –æ—Å—ñ–±',
        data: Object.values(regionData),
        backgroundColor: COLORS.other,
        borderRadius: 10
      }]
    },
    options: {
      scales: {
        x: { ticks: { color: COLORS.text } },
        y: { beginAtZero: true, ticks: { color: COLORS.text } }
      },
      plugins: { legend: { display: false } }
    }
  });

  // üóìÔ∏è –ì—Ä–∞—Ñ—ñ–∫ –Ω–æ–≤–∏—Ö –∑–∞ —Ç–∏–∂–¥–µ–Ω—å (–∫–æ–º–ø–∞–∫—Ç–Ω–∏–π)
  new Chart(document.getElementById('weeklyChart'), {
    type: 'line',
    data: {
      labels: Object.keys(weeklyData),
      datasets: [{
        label: '–ù–æ–≤—ñ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è',
        data: Object.values(weeklyData),
        fill: true,
        borderColor: COLORS.others,
        backgroundColor: 'rgba(72, 61, 139,0.15)',
        tension: 0.35,
        pointRadius: 4
      }]
    },
    options: {
      plugins: { legend: { display: false } },
      scales: {
        x: { ticks: { color: COLORS.text } },
        y: { beginAtZero: true, ticks: { color: COLORS.text } }
      }
    }
  });
</script>

<!-- üé® –°—Ç–∏–ª—ñ -->
<style>
  :root {
    --missing-color: #ff6b6b;
    --found-color: #38d39f;
    --other-color: #4dabf7;
  }

  .metric-card {
    color: #fff;
    text-align: center;
    padding: 20px;
    border-radius: 16px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }

  .metric-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.15);
  }

  .metric-card.missing { background: var(--missing-color); }
  .metric-card.found { background: var(--found-color); }
  .metric-card.other { background: var(--other-color); }

  .chart-card {
    background-color: var(--bs-body-bg);
    color: var(--bs-body-color);
    border: none;
    transition: all 0.3s ease;
  }

  /* üåô –¢–µ–º–Ω–∞ —Ç–µ–º–∞ */
  body[data-theme='dark'] .chart-card {
    background-color: #1f1f1f;
    color: #f1f1f1;
  }

  footer { margin-top: 80px !important; }
</style>

{% endblock %}
