{% extends 'base.html' %}
{% block content %}
<div class="container mb-5">

  <div class="text-center mt-5 mb-4">
    <h1 class="fw-bold display-5 mb-2">üîç FindMe</h1>
    <p class="lead mb-4 page-subtitle">
      –°–µ—Ä–≤—ñ—Å –¥–ª—è –ø–æ—à—É–∫—É –∑–Ω–∏–∫–ª–∏—Ö –ª—é–¥–µ–π ‚Äî –¥–æ–ø–æ–º–æ–∂—ñ—Ç—å –∑–Ω–∞–π—Ç–∏ –±–ª–∏–∑—å–∫–∏—Ö.
    </p>
    <a href="/add/" class="btn btn-primary btn-lg shadow-sm">
      <i class="bi bi-plus-circle"></i> –î–æ–¥–∞—Ç–∏ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è
    </a>
  </div>

  <!-- üîé –ü–æ—à—É–∫, —Ñ—ñ–ª—å—Ç—Ä–∏ —Ç–∞ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
  <form method="get" id="searchForm" class="row g-3 justify-content-center mb-5">
    <div class="col-md-3 col-sm-6">
      <input type="text" name="q" value="{{ query }}" class="form-control rounded-3"
             placeholder="–ü–æ—à—É–∫ –∑–∞ —ñ–º‚Äô—è–º...">
    </div>

    <div class="col-md-3 col-sm-6">
      <input type="text" name="city" value="{{ city }}" class="form-control rounded-3"
             placeholder="–ú—ñ—Å—Ç–æ...">
    </div>

    <div class="col-md-2 col-sm-6">
      <input type="date" name="date" value="{{ date }}" class="form-control rounded-3">
    </div>

    <!-- üß≠ –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
    <div class="col-md-3 col-sm-6">
      <select name="sort" id="sortSelect" class="form-select rounded-3">
        <option value="">–°–æ—Ä—Ç—É–≤–∞—Ç–∏ –∑–∞...</option>
        <option value="name_asc" {% if sort == 'name_asc' %}selected{% endif %}>–Ü–º‚Äô—è–º (A‚Äì–Ø)</option>
        <option value="name_desc" {% if sort == 'name_desc' %}selected{% endif %}>–Ü–º‚Äô—è–º (–Ø‚ÄìA)</option>
        <option value="date_latest" {% if sort == 'date_latest' %}selected{% endif %}>–î–∞—Ç–æ—é (—Å–ø–æ—á–∞—Ç–∫—É –Ω–æ–≤—ñ)</option>
        <option value="date_oldest" {% if sort == 'date_oldest' %}selected{% endif %}>–î–∞—Ç–æ—é (—Å–ø–æ—á–∞—Ç–∫—É —Å—Ç–∞—Ä—ñ)</option>
        <option value="city" {% if sort == 'city' %}selected{% endif %}>–ú—ñ—Å—Ç–æ–º</option>
      </select>
    </div>

    <div class="col-md-1 d-grid">
      <button type="submit" class="btn btn-primary rounded-3 fw-semibold shadow-sm">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </form>

  <!-- üßæ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ -->
  <div class="row g-4">
    {% for person in page_obj %}
      <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0 rounded-4 result-card">
          {% if person.photo %}
            <img src="{{ person.photo.url }}" class="card-img-top rounded-top-4" alt="{{ person.full_name }}">
          {% endif %}
          <div class="card-body">
            <h5 class="card-title fw-semibold text-primary">{{ person.full_name }}</h5>
            <p class="text-muted small mb-1">
              <i class="bi bi-geo-alt"></i> {{ person.city }}, {{ person.region }}
            </p>
            <p class="text-muted small mb-2">
              <i class="bi bi-calendar-event"></i> {{ person.missing_date }}
            </p>

            <!-- üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä—ñ—è + —Å—Ç–∞—Ç—É—Å -->
            <p class="mb-3">
              {% if person.category %}
                <span class="badge bg-info text-dark">{{ person.get_category_display }}</span>
              {% endif %}
              {% if person.status %}
                <span class="badge {% if person.status == 'found' %}bg-success{% else %}bg-danger{% endif %}">
                  {{ person.get_status_display }}
                </span>
              {% endif %}
            </p>

            <a href="{% url 'missing_detail' person.pk %}" class="btn btn-outline-primary w-100">
              –î–µ—Ç–∞–ª—å–Ω—ñ—à–µ
            </a>
          </div>
        </div>
      </div>
    {% empty %}
      <p class="text-center text-muted">–ù–µ–º–∞—î –æ–≥–æ–ª–æ—à–µ–Ω—å –∑–∞ —Ü–∏–º–∏ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ üòî</p>
    {% endfor %}
  </div>

  <!-- üìÑ –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
  {% if page_obj.has_other_pages %}
  <div class="d-flex justify-content-center mt-5">
    <ul class="pagination">
      {% if page_obj.has_previous %}
        <li class="page-item">
          <a class="page-link" href="?{% if query %}q={{ query }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if date %}date={{ date }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.previous_page_number }}">¬´</a>
        </li>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <li class="page-item active"><span class="page-link">{{ num }}</span></li>
        {% else %}
          <li class="page-item">
            <a class="page-link" href="?{% if query %}q={{ query }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if date %}date={{ date }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ num }}">{{ num }}</a>
          </li>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <li class="page-item">
          <a class="page-link" href="?{% if query %}q={{ query }}&{% endif %}{% if city %}city={{ city }}&{% endif %}{% if date %}date={{ date }}&{% endif %}{% if sort %}sort={{ sort }}&{% endif %}page={{ page_obj.next_page_number }}">¬ª</a>
        </li>
      {% endif %}
    </ul>
  </div>
  {% endif %}
</div>

<!-- üí° JS: –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–∏ –∑–º—ñ–Ω—ñ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è -->
<script>
  document.getElementById('sortSelect').addEventListener('change', function() {
    document.getElementById('searchForm').submit();
  });
</script>
{% endblock %}
