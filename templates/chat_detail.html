{% extends 'base.html' %}
{% block content %}
<h3>Чат із {{ other_user.username }}</h3>

<div class="border p-3 mb-3 bg-light rounded" style="height: 400px; overflow-y: auto;">
  {% for msg in messages %}
    <div class="mb-3 {% if msg.sender == user %}text-end{% endif %}">
      <div class="d-inline-block p-2 rounded-3 
        {% if msg.sender == user %}
          bg-primary text-white
        {% else %}
          bg-secondary text-light
        {% endif %}" 
        style="max-width: 70%; position: relative;">
        <p class="mb-1">{{ msg.text }}</p>
        <div class="d-flex {% if msg.sender == user %}justify-content-end{% endif %}">
          <small class="text-muted mt-1" style="font-size: 0.8em;">
            {{ msg.created_at|date:"H:i" }}
          </small>
          {% if msg.sender == user %}
            <small class="ms-1">
              {% if msg.is_read %}
                <span style="color:#4fc3f7;">✔✔</span> <!-- Прочитано -->
              {% else %}
                <span style="color:lightgray;">✔</span> <!-- Надіслано -->
              {% endif %}
            </small>
          {% endif %}
        </div>
      </div>
    </div>
  {% empty %}
    <p class="text-center text-muted">Немає повідомлень.</p>
  {% endfor %}
</div>

<form method="post">
  {% csrf_token %}
  <div class="input-group">
    <input type="text" name="text" class="form-control" placeholder="Введіть повідомлення..." required>
    <button class="btn btn-primary" type="submit">Надіслати</button>
  </div>
</form>

<a href="/chat/" class="btn btn-secondary mt-3">← Назад</a>

<script>
  // автоматична прокрутка вниз до останнього повідомлення
  const chatBox = document.querySelector('.border');
  chatBox.scrollTop = chatBox.scrollHeight;
</script>
{% endblock %}
